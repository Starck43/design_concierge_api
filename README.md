# designer concierge
Чат бот телеграм для дизайнеров

## Хранилище данных в телеграм (context)

### user_data:
    Контекст персональных данных пользователя, загружаемый при необходимости с сервера

### chat_data:
    Контекст данных, имеющий отношение к чату, 
    включая его статус, состояние диалога, сообщений, клавиатуры, геопозиция и др.

- `menu`
массив сохраненных состояний интерфейса (_menu состояние, reply сообщение, inline сообщения, reply клавиатура, inline клавиатура_)
```json lines
[{
    "state": <MenuState>, // type Enum
    "message": <reply_message>, // type Message
    "inline_message": <inline_message>, // type Message or list of Message
    "markup": <reply_markup>, // type ReplyKeyboardMarkup
    "inline_markup": <inline_markup> // InlineKeyboardMarkup
}]
```
```python
# Для удобства создана функция, которая добавляет в chat_data["menu"] новый объект в конец списка
# Пример сохранения нового состояния меню:
from bot.handlers.common import add_menu_item
from bot.states.main import MenuState
state = MenuState.SUPPLIERS_REGISTER
add_menu_item(context, state=state, markup=back_menu)
```

- `cats`
список всех категорий со всеми связанными пользователями (в дальнейшем надо предусмотреть еще разбиение на регионы)


- `cat_users`
словарь, хранящий запрошенные списки пользователей в категории. Ключ объекта - это id категории


- `suppliers`
словарь, хранящий запрошенные данные о поставщиках. Ключ объекта - это id пользователя


- `selected_cat`
объект с данными для текущей категории {id, name, group}


- `selected_user`
объект с данными о текущем пользователе {id, username, groups, total_rate и др}


- `saved_message`
    Сохраненное сообщение с инлайн клавиатурой, которое будет показано после возврата на верхний уровень меню. \
    _Удалится после отображения (см. функцию go_back)_


- `saved_details_message`
    Сохраненное сообщение карточки пользователя с инлайн клавиатурой с целью обновления измененных данных 


- `last_message_id`
    ID последнего сохраненного сообщения с инлайн клавиатурой для возможности замены сообщения на новое


- `last_message_ids`
    Список ID сохраненных сообщений, которые требуется удалить при возврате на верхний уровень меню


- `local_data`
    Временная переменная для хранения промежуточных данных на текущем уровне меню, которая удаляется при возврате назад

### bot_data:
    Контекст общедоступных данных для всех пользователей бота


- `user_field_names`
Словарь названий полей модели User для изменения в профиле пользователя
```json5
{
    "username": "Имя пользователя",
    "name": "Полное название",
    "access": "Вид доступа",
    "description": "Описание",
    "business_start_year": "Год начала деятельности",
    "main_region": "Основной регион",
    "segment": "Сегмент рынка",
    "address": "Адрес",
    "phone": "Контактный телефон",
    "email": "Электронная почта",
    "socials_url": "Ссылка на соцсеть",
    "site_url": "Ссылка на сайт",
    "categories": "Виды деятельности",
    "regions": "Дополнительные регионы"
}
```

- `rating_questions`
список вопросов для выставления рейтинга для двух групп поставщиков: аутсорсеры и поставщики
```json5
[
    {
        "deadlines": "Соблюдение сроков",
        "sales_service_quality": "Качество сервиса при продаже товаров/услуг"
    },
    {
        "quality": "Качество продукции",
        "deadlines": "Соблюдение сроков",
        "sales_service_quality": "Качество сервиса при продаже товаров/услуг",
        "service_delivery_quality": "Качество сервиса при установке/выполнении работ",
        "designer_program_quality": "Работа с дизайнерами",
        "location": "Удобство расположения"
    }
]
```

## Для разработчиков
- [ссылка на TODO для реализации](docs/TODO.md)


## Additional
examples: https://github.com/ohld/django-telegram-bot
